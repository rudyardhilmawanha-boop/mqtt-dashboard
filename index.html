<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard MQTT HiveMQ</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <h1>Dashboard IoT MQTT</h1>
  <p>Data suhu (temperature) dari topik <b>IDS_Temp01</b> :</p>
  <div>
    <span id="temp">--</span> Â°C
  </div>

<script>
  // URL broker HiveMQ Dashboard (gunakan wss karena WebSocket Secure, port 8884)
  const client = mqtt.connect('wss://mqtt-dashboard.com:8884/mqtt', {
    username: 'intidaya',          // ganti sesuai username Anda
    password: '1Nt1d4y4',      // isi dengan password yang benar
    clientId: 'clientId-WebApp-' + Math.random().toString(16).substr(2, 8), // unik
    clean: true,                   // sama seperti clean session di dashboard
    reconnectPeriod: 1000          // auto reconnect tiap 1 detik
  });

  client.on('connect', () => {
    console.log('Terhubung ke broker mqtt-dashboard.com');
    client.subscribe('IDS_Temp01', (err) => {
      if (!err) {
        console.log('Berhasil subscribe ke topik IDS_Temp01');
      } else {
        console.error('Gagal subscribe:', err);
      }
    });
  });

  client.on('message', (topic, message) => {
    if (topic === 'IDS_Temp01') {
      const temp = message.toString();
      document.getElementById('temp').textContent = temp;
    }
  });

  client.on('error', (err) => {
    console.error('MQTT Error:', err);
  });
</script>

</body>
</html>
